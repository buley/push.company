<!DOCTYPE html>
<html>
<head>
  <title>explore</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, user-scalable=no">
	<script data-main="/explore/app" src="/explore/lib/require.js"></script>
  <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
  <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
	<script src='https://api.tiles.mapbox.com/mapbox.js/v2.0.1/mapbox.js'></script>
	<link href='https://api.tiles.mapbox.com/mapbox.js/v2.0.1/mapbox.css' rel='stylesheet' />
	<style>
		body { margin:0; padding:0; }
		#map { position:absolute; top:0; bottom:0; width:100%; }
	</style>
  <style type="text/css">
    body, html {
      width: 100%;
      height: 100%;
    }
    header, section, footer, aside, nav, article, figure, audio, video, canvas  { display:block; }
  </style>
</head>
<body>
  <div id="wrapper">
    <nav style="clear:both;">
      <a href="#content" id="header">&#9114;</a>
    </nav>
    <section id="content">
			<div id='map'></div>
    </section>
    <footer style="clear:both;">
      <a href="#content" id="header">&#8613;</a>
    </footer>
  </div>
	<script>
		(function() {
			var getQueryStringValue = function(qs, variable) {
					var pair,
							vars = qs.split('&'),
							i;
					for (i = 0; i < vars.length; i++) {
							pair = vars[i].split('%3D');
							if (decodeURIComponent(pair[0]) === variable) {
									return decodeURIComponent(pair[1]);
							}
					}
				}, appendQuery = function() {
var x = getQueryStringValue( window.location.hash.replace(/^#/, ''), 'x' ),
    msg;
if ( !!x ) {
  try {
    msg = JSON.parse( x );
    if (!!msg) {
      $( '#content' ).append( [
        '<article style="padding: 10px; margin-bottom: 10px; border-bottom: 1px solid #1a1a1a; background: #ccc;">',
        JSON.stringify( msg ),
        '</article>'
      ].join('') );
    }
  } catch( e ) {
    //nothing yet
  }
  window.location.hash = "#ready=true";
}
e.preventDefault();
e.stopPropigation();
};
$('#wrapper').on('click', 'a', function(e) {
$( '#content' ).html('');
e.preventDefault();
e.stopPropigation();
});
window.addEventListener( 'popstate', appendQuery );
}());
</script>
<script>
(function() {
		L.mapbox.accessToken = 'pk.eyJ1IjoiYnVsZXkiLCJhIjoiZWwySzE4cyJ9.tKVH4x1b-W4ag-s7jqRKlA';
		var map = L.mapbox.map('map', 'buley.j737pbkc'),
				locd= false,
				getParams = function() {
					return [ 38.538901, -121.700335, 15 ];
				},
				params = getParams(),
				lat = params[0],
				lon = params[1],
				radius = params[2];
		map.setView( L.latLng(lat, lon), 16 );
		L.circleMarker( L.latLng(lat, lon), { radius: radius }).addTo(map);

		$.ajax( {
			method: 'GET',
			dataType: 'json',
			url: 'http://23.236.54.41/?latitude=' + lat + '&longitude=' + lon + '&max=1000',
			success: function(data) {
				var x,
						xlen = data.Data.length,
						item;
				for(x = 0; x < xlen; x += 1) {
					item = data.Data[x];
					L.circleMarker( L.latLng(item.Location.Latitude, item.Location.Longitude, { radius: item.Location.Radius }).addTo(map);
				}
			}
		} );

}());
</script>
</body>
</html>
